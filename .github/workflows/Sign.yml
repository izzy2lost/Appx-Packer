name: Sign MSIX Package

on:
  push:
    branches:
      - main  # or whichever branch you prefer to trigger this workflow

jobs:
  sign-msix:
    runs-on: windows-latest

    steps:
    # Step 1: Checkout the Appx-Packer repository
    - name: Checkout Appx-Packer repository
      uses: actions/checkout@v4

    # Step 2: Unpack MSIX package using 7zip
    - name: Unpack MSIX package using 7zip
      run: |
        # Unpack the MSIX file
        & "C:\Program Files\7-Zip\7z.exe" x sdl-min_1.0.0.0_x64.msix -oextracted

    # Step 3: Sign MSIX package using Appx-Packer
    - name: Run Appx-Packer to sign MSIX
      run: |
        # Navigate to the Appx-Packer directory and run the signing process
        cd Appx-Packer
        Start-Process -FilePath "appx-packer.exe" -ArgumentList `
          "/input ../extracted", `
          "/output ../signed_output/signed_sdl-min_1.0.0.0_x64.msix", `
          "/cert ../certificate.pfx", `
          "/password 1330" `
          -Wait

    # Step 4: Upload the signed MSIX package
    - name: Upload signed MSIX package
      uses: actions/upload-artifact@v4
      with:
        name: signed-msix
        path: signed_output/signed_sdl-min_1.0.0.0_x64.msix
